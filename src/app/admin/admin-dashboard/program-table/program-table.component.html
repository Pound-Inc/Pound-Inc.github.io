<div class="row">
  <div class="col-xl-12 mt-4">
    <div class="card border-0">
      <div>
        <h4 class="p-4">
          {{ translateBaseRoute + "Training Programs" | translate }}
        </h4>
        <div
          class="mb-3 row align-items-center justify-content-start ms-1 gap-2 px-2 col-9"
        >
          <div class="col-2 px-0 mx-0">
            <input
              id="table-complete-search"
              type="text"
              class="form-control"
              name="searchTerm"
              [(ngModel)]="programService.searchTerm"
              placeholder="Search by Name..."
            />
          </div>
          <div class="col-2 px-0 mx-0">
            <button class="btn btn-light w-100 px-0 mx-0" (click)="editRow()">
              + {{ translateBaseRoute + "New Program" | translate }}
            </button>
          </div>
          <div class="col-2 px-0 mx-0">
            <button
              class="btn btn-secondary w-100 px-0 mx-0"
              [disabled]="!selectedCountry"
              (click)="editRow()"
            >
              Edit
            </button>
          </div>
          <div class="col-1 px-0 mx-0">
            <button
              class="btn btn-danger w-100 px-0 mx-0"
              [disabled]="!selectedCountry"
              (click)="deleteRow()"
            >
              Delete
            </button>
          </div>
        </div>
      </div>

      <div class="table-responsive shadow rounded-bottom" style="height: 545px">
        <form class="mt-3">
          <table class="table">
            <thead>
              <tr class="sticky-header">
                <th
                  *ngFor="let key of columns"
                  scope="col"
                  sortable="name"
                  (sort)="onSort($event)"
                >
                  {{ key.name }}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let program of programs$ | async"
                (click)="onRowClick(program)"
                [class.clicked-row]="
                  selectedCountry && selectedCountry.id === program.id
                "
              >
                <td *ngFor="let key of columns">
                  <ng-container *ngIf="key.type === 'text'">
                    <td>
                      {{ formatValue(program[key.id]) }}
                    </td>
                  </ng-container>
                  <ng-container *ngIf="key.type === 'lookup'">
                    <td>
                      {{ formatValue(program[key.id]) }}
                      <div>
                        <small class="text-muted">
                          add reference to the lookup
                        </small>
                      </div>
                    </td>
                  </ng-container>

                  <ng-container *ngIf="key.id === 'phases'">
                    <td>
                      <div ngbDropdown container="body">
                        <button
                          type="button"
                          class="btn btn-light btn-sm"
                          ngbDropdownToggle
                        >
                          Details ({{ formatValue(program[key.id]).length }})
                        </button>
                        <div ngbDropdownMenu>
                          <div
                            ngbDropdownItem
                            disabled
                            *ngFor="let phase of formatValue(program[key.id])"
                          >
                            <h6>
                              {{ phase }} {{ program[key.id][phase] + "%" }}
                            </h6>
                            <div class="progress mt-1">
                              <div
                                class="progress-bar position-relative bg-secondary"
                                [style.width.%]="program[key.id][phase]"
                              ></div>
                            </div>
                            <div class="dropdown-divider"></div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </ng-container>
                  <ng-container *ngIf="key.type === 'link'">
                    <td>
                      <button
                        class="btn btn-light btn-sm me-1"
                        (click)="open(content)"
                      >
                        <span class="mdi mdi-content-copy"></span>
                      </button>
                      <button
                        class="btn btn-light btn-sm me-1"
                        (click)="open(content)"
                      >
                        <span class="mdi mdi-pencil"></span>
                      </button>
                      <button
                        class="btn btn-light btn-sm"
                        (click)="open(content)"
                      >
                        <span class="mdi mdi-open-in-new"></span>
                      </button>
                      <div class="mt-1">
                        <small class="text-muted">
                          {{ formatValue(program[key.id]) }}
                        </small>
                      </div>
                    </td>
                  </ng-container>
                </td>
              </tr>
              <tr
                *ngIf="!(programs$ | async)"
                colspan="4"
                style="text-align: center"
              >
                No programs found
              </tr>
            </tbody>
          </table>
        </form>
      </div>
      <div class="d-flex justify-content-between p-2">
        <ngb-pagination
          [collectionSize]="(total$ | async)!"
          [(page)]="programService.page"
          [pageSize]="programService.pageSize"
        >
        </ngb-pagination>

        <select
          class="form-select"
          style="width: auto"
          name="pageSize"
          [(ngModel)]="programService.pageSize"
        >
          <option [ngValue]="10">10 items per page</option>
          <option [ngValue]="50">50 items per page</option>
          <option [ngValue]="100">100 items per page</option>
        </select>
      </div>
    </div>
  </div>
</div>

<ng-template #content let-modal>
  <div class="modal-body">ad</div>
</ng-template>
