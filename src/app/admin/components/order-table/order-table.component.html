<div class="card border-0">
  <div>
    <h4 class="p-4">{{ "Orders" | translate }} ({{ orders.length }})</h4>
    <div
      class="mb-3 row align-items-center justify-content-start ms-1 gap-2 px-2 col-12"
    >
      <div class="col-3 px-0 mx-0">
        <input
          id="table-complete-search"
          type="text"
          class="form-control"
          name="searchTerm"
          placeholder="Search by Name..."
        />
      </div>
      <div class="col-2 px-0 mx-0">
        <button class="btn btn-light w-100 px-0 mx-0" (click)="editRow()">
          <span class="mdi mdi-plus"></span>
        </button>
      </div>
      <div class="col-2 px-0 mx-0">
        <button
          class="btn btn-secondary w-100 px-0 mx-0"
          [disabled]="!selectedRow"
          (click)="editRow()"
        >
          <span class="mdi mdi-pencil"></span>
        </button>
      </div>
      <div class="col-1 px-0 mx-0">
        <button
          class="btn btn-danger w-100 px-0 mx-0"
          [disabled]="!selectedRow"
          (click)="deleteRow()"
        >
          <span class="mdi mdi-delete"></span>
        </button>
      </div>
    </div>
  </div>

  <div class="row d-flex">
    <div
      class="col table-responsive border-bottom border-light border-top rounded-bottom"
      style="height: 545px"
      *ngIf="orders && programs"
    >
      <form class="mt-3">
        <table class="table">
          <thead>
            <tr class="sticky-header">
              <th *ngFor="let column of columns">
                {{ column.name }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let order of orders"
              (click)="onRowClick(order)"
              [class.clicked-row]="selectedRow && selectedRow._id === order._id"
            >
              <td
                *ngFor="let column of columns"
                [style.minWidth]="column.width + 'px'"
              >
                <ng-container
                  *ngIf="column.type === 'text' && column._id !== 'user_id'"
                >
                  {{ order[column._id] }}
                </ng-container>

                <ng-container *ngIf="column.type === 'number'">
                  {{ order[column._id] | currency }}
                </ng-container>
                <ng-container *ngIf="column.type === 'date'">
                  <span class="mdi mdi-calendar"></span>
                  {{ order[column._id] | date : "dd/MM/yyyy" }}
                  <br />
                  <span class="mdi mdi-clock-outline"></span>
                  {{ order[column._id] | date : "HH:mm:ss" }}
                </ng-container>
                <ng-container *ngIf="column.type === 'array'">
                  <ul>
                    <li *ngFor="let item of order[column._id]">
                      <div class="row d-flex gap-2 align-items-start">
                        <div class="col-2">
                          <img
                            src="{{ getRelatedProgram(item.program_id)?.img }}"
                            alt="profile img"
                            class="rounded-circle"
                            style="object-fit: cover; height: 42px; width: 42px"
                          />
                        </div>
                        <div class="col my-0 py-0">
                          <h6
                            class="my-0 py-0 mb-1"
                            style="font-weight: lighter"
                          >
                            <strong>PROGRAM ID:</strong> {{ item.program_id }}
                          </h6>
                          <h6 style="font-weight: lighter">
                            <strong>PLAN ID:</strong> {{ item._id }}
                          </h6>
                        </div>
                      </div>
                    </li>
                  </ul>
                </ng-container>
                <ng-container *ngIf="column.type === 'dropdown'">
                  <select
                    class="form-control"
                    (change)="onStatusChange($event, order)"
                  >
                    <option
                      *ngFor="let status of orderStatuses"
                      [ngValue]="status"
                      [selected]="status === order.status"
                    >
                      {{ status }}
                    </option>
                  </select>
                </ng-container>
              </td>
            </tr>
          </tbody>
        </table>
      </form>
    </div>

    <div
      class="col-3 card border-bottom border-light border-top rounded-bottom bg-light"
      style="height: 545px"
    >
      <div class="card-header bg-light border-0">User Details</div>
      <div class="card-body" *ngIf="selectedRow">
        <div class="row d-flex gap-2 align-items-center">
          <div class="col-2">
            <img
              src="{{ getRelatedUser(selectedRow.user_id)?.img }}"
              alt="profile img"
              class="rounded-circle"
              width="42"
            />
          </div>
          <div class="col">
            <h6 class="p-0 m-0">
              {{ getRelatedUser(selectedRow.user_id)?.name }}
            </h6>
          </div>
        </div>

        <ul class="list-group border-0 mt-4">
          <li
            class="border-top-0 list-group-item border-left-0 border-right-0 rounded-0"
          >
            <div class="row d-flex align-items-center">
              <h4 class="col py-0 my-0 text-start">
                <span class="mdi mdi-human-male-height-variant"></span>
              </h4>
              <h6 class="col py-0 my-0 text-end">
                {{ getRelatedUser(selectedRow.user_id)?.height || 0 }} cm
              </h6>
            </div>
          </li>
          <li
            class="border-top-0 list-group-item border-left-0 border-right-0 rounded-0"
          >
            <div class="row d-flex align-items-center">
              <h4 class="col py-0 my-0 text-start">
                <span class="mdi mdi-weight"></span>
              </h4>
              <h6 class="col py-0 my-0 text-end">
                {{ getRelatedUser(selectedRow.user_id)?.weight || 0 }} kg
              </h6>
            </div>
          </li>
          <li
            class="border-top-0 list-group-item border-left-0 border-right-0 rounded-0"
          >
            <div class="row d-flex align-items-center">
              <h4 class="col py-0 my-0 text-start">
                <span class="mdi mdi-ray-start-vertex-end"></span>
              </h4>
              <h6 class="col py-0 my-0 text-end">
                {{ getRelatedUser(selectedRow.user_id)?.level || 0 }}
              </h6>
            </div>
          </li>
          <li
            class="border-top-0 list-group-item border-left-0 border-right-0 rounded-0"
          >
            <div class="row d-flex align-items-center">
              <h4 class="col py-0 my-0 text-start">
                <span class="mdi mdi-flag-checkered"></span>
              </h4>
              <h6 class="col py-0 my-0 text-end">
                {{
                  getUserGoals(getRelatedUser(selectedRow.user_id)?.goals)
                    | json
                }}
              </h6>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
