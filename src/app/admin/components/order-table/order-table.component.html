<div class="card border-0">
  <div>
    <h4 class="p-4">{{ "Orders" | translate }} ({{ orders.length }})</h4>
    <div
      class="mb-3 row align-items-center justify-content-start ms-1 gap-2 p-2"
    >
      <div class="col-1">
        <button class="btn btn-light" (click)="refreshGrid()">
          <span class="mdi mdi-refresh my-0 py-0"></span>
          Refresh
        </button>
      </div>
      <div class="col-2">
        <label for="filterByStatus"> Filter By: </label>
        <select
          name="filterByStatus"
          class="form-control py-0 my-0"
          (change)="onFilterChange($event)"
        >
          <option selected>-</option>
          <option
            *ngFor="let status of orderStatuses"
            [ngValue]="status"
            [value]="status"
          >
            {{ status }} ({{ getOrdersLength(status) }})
          </option>
        </select>
      </div>
    </div>
  </div>

  <div class="row d-flex">
    <div
      class="col table-responsive border-bottom border-light border-top rounded-bottom"
      style="height: 545px"
      *ngIf="orders && programs"
    >
      <form class="mt-3">
        <table class="table">
          <thead>
            <tr class="sticky-header">
              <th *ngFor="let column of columns">
                {{ column.name }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let order of orders"
              (click)="onRowClick(order)"
              [class.clicked-row]="selectedRow && selectedRow._id === order._id"
            >
              <td
                *ngFor="let column of columns"
                [style.minWidth]="column.width + 'px'"
              >
                <ng-container
                  *ngIf="column.type === 'text' && column._id !== 'user_id'"
                >
                  {{ order[column._id] }}
                </ng-container>

                <ng-container *ngIf="column.type === 'number'">
                  {{ order[column._id] | currency }}
                </ng-container>
                <ng-container *ngIf="column.type === 'date'">
                  <span class="mdi mdi-calendar"></span>
                  {{ order[column._id] | date : "dd/MM/yyyy" }}
                  <br />
                  <span class="mdi mdi-clock-outline"></span>
                  {{ order[column._id] | date : "HH:mm:ss" }}
                </ng-container>
                <ng-container
                  *ngIf="column.type === 'array' && column._id === 'items'"
                >
                  <ul>
                    <li *ngFor="let item of order[column._id]">
                      <div class="row d-flex gap-2 align-items-start">
                        <div class="col-2">
                          <img
                            src="{{ getRelatedProgram(item.program_id)?.img }}"
                            alt="profile img"
                            class="rounded-circle"
                            style="object-fit: cover; height: 42px; width: 42px"
                          />
                        </div>
                        <div class="col my-0 py-0">
                          <h6
                            class="my-0 py-0 mb-1"
                            style="font-weight: lighter"
                          >
                            <strong>PROGRAM ID:</strong> {{ item.program_id }}
                          </h6>
                          <h6 style="font-weight: lighter">
                            <strong>PLAN ID:</strong> {{ item.name }}
                          </h6>
                          <h6 style="font-weight: lighter">
                            <strong>PRICE:</strong> {{ item.price | currency }}
                          </h6>
                        </div>
                      </div>
                    </li>
                  </ul>
                </ng-container>
                <ng-container
                  *ngIf="column.type === 'array' && column._id === 'addons'"
                >
                  {{ getAddons(order[column._id]) | json }}
                  <h6 style="font-weight: lighter">
                    <strong>TOTAL:</strong>
                    {{ getAddonsTotalPrice(order[column._id]) | currency }}
                  </h6>
                </ng-container>
                <ng-container *ngIf="column.type === 'dropdown'">
                  <select
                    class="form-control"
                    (change)="onStatusChange($event, order)"
                    [disabled]="order.status === 'Canceled'"
                    [ngClass]="{
                      'New': order.status === 'New',
                      'InProgress': order.status === 'InProgress',
                      'Delivered': order.status === 'Delivered',
                      'Closed': order.status === 'Closed',
                      'Canceled': order.status === 'Canceled',
                      'Completed': order.status === 'Completed',
                    }"
                  >
                    <option
                      *ngFor="let status of orderStatuses"
                      [ngValue]="status"
                      [value]="status"
                      [selected]="status === order.status"
                    >
                      {{ status }}
                    </option>
                  </select>
                </ng-container>
              </td>
            </tr>
          </tbody>
        </table>
      </form>
    </div>

    <div
      class="col-3 card border-bottom border-light border-top rounded-bottom bg-light"
      style="height: 545px"
    >
      <div class="card-header bg-light border-0">User Details</div>
      <div class="card-body" *ngIf="selectedRow && user">
        <div class="row d-flex gap-2 align-items-center">
          <div class="col-2">
            <img
              src="{{ this.user.img }}"
              alt="profile img"
              class="rounded-circle"
              width="42"
            />
          </div>
          <div class="col">
            <h6 class="p-0 m-0">
              {{ this.user.name }}
            </h6>
            <span>{{ this.user.email }}</span>
            <br />
            <span>
              {{ this.user.dob | date : "YYYY/MM/dd" }}
            </span>
          </div>
        </div>

        <ul class="list-group border-0 mt-4">
          <li
            class="border-top-0 list-group-item border-left-0 border-right-0 rounded-0"
          >
            <div class="row d-flex align-items-center">
              <h4 class="col py-0 my-0 text-start">
                <span class="mdi mdi-human-male-height-variant"></span>
              </h4>
              <h6 class="col py-0 my-0 text-end">
                {{ this.user.height || 0 }} cm
              </h6>
            </div>
          </li>
          <li
            class="border-top-0 list-group-item border-left-0 border-right-0 rounded-0"
          >
            <div class="row d-flex align-items-center">
              <h4 class="col py-0 my-0 text-start">
                <span class="mdi mdi-weight"></span>
              </h4>
              <h6 class="col py-0 my-0 text-end">
                {{ this.user.weight || 0 }} kg
              </h6>
            </div>
          </li>
          <li
            class="border-top-0 list-group-item border-left-0 border-right-0 rounded-0"
          >
            <div class="row d-flex align-items-center">
              <h4 class="col py-0 my-0 text-start">
                <span class="mdi mdi-ray-start-vertex-end"></span>
              </h4>
              <h6 class="col py-0 my-0 text-end">
                {{ this.user.level || 0 }}
              </h6>
            </div>
          </li>
          <li
            class="border-top-0 list-group-item border-left-0 border-right-0 rounded-0"
          >
            <div class="row d-flex align-items-center">
              <h4 class="col py-0 my-0 text-start">
                <span class="mdi mdi-flag-checkered"></span>
              </h4>
              <h6 class="col py-0 my-0 text-end">
                {{ getUserGoals(this.user.goals) | json }}
              </h6>
            </div>
          </li>
        </ul>
        <button
          class="btn btn-primary mt-2 w-100"
          [disabled]="
            !(
              selectedRow.status !== 'Completed' &&
              selectedRow.status !== 'Canceled' &&
              selectedRow.status !== 'Delivered'
            )
          "
        >
          Create Training Program
        </button>
        <button
          [disabled]="!(selectedRow.status === 'Completed')"
          class="btn btn-secondary mt-2 w-100"
        >
          Deliver Program
        </button>
      </div>
    </div>
  </div>
</div>
